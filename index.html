<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Moufette vs Champignons</title>
<style>
  body { margin:0; overflow:hidden; touch-action:none; background:#000;}
  canvas { display:block;}
  #ui {
    position:absolute; top:10px; left:10px;
    color:white; font-family:Arial; font-size:20px;
    z-index: 10;
  }
  #healthBar, #shieldBar {
    position:absolute; left:10px; height:20px; background:#555;
    z-index: 10;
  }
  #healthBar { top:40px; width:200px; background:red; }
  #shieldBar { top:65px; width:200px; background:blue; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nipplejs@0.9.0/dist/nipplejs.min.css">
</head>
<body>

<div id="ui">Niv 1</div>
<div id="healthBar"></div>
<div id="shieldBar"></div>
<canvas id="gameCanvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/nipplejs@0.9.0/dist/nipplejs.min.js"></script>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Joueur (moufette dessinée)
const player = {
  x: canvas.width/2,
  y: canvas.height/2,
  size: 60,
  speed: 5,
  life: 100,
  maxLife:100,
  shields:50,
  maxShields:50
};

// Champignons (formes simples mais reconnaissables)
const mushrooms = [];
for(let i=0;i<12;i++){
  mushrooms.push({
    x: Math.random()*(canvas.width-40)+20,
    y: Math.random()*(canvas.height-40)+20,
    width: 30,
    height: 40,
    stemColor:"#D2B48C",
    capColor:"#8B0000"
  });
}

// Projectiles verts
const bullets = [];

// Joystick mobile
let moveX=0, moveY=0;
let shootX=0, shootY=0;

const joystickLeft = nipplejs.create({
  zone: document.body,
  mode: 'static',
  position: { left: '100px', bottom: '100px' },
  color: 'white',
  size:100
});
joystickLeft.on('move', (evt, data)=>{ moveX = data.vector.x; moveY = data.vector.y; });
joystickLeft.on('end', ()=>{ moveX=0; moveY=0; });

const joystickRight = nipplejs.create({
  zone: document.body,
  mode: 'static',
  position: { right: '100px', bottom: '100px' },
  color: 'yellow',
  size:100
});
joystickRight.on('move', (evt,data)=>{ shootX = data.vector.x; shootY = data.vector.y; });
joystickRight.on('end', ()=>{ shootX=0; shootY=0; });

// Tir
function shoot(){
  if(shootX!==0 || shootY!==0){
    bullets.push({
      x: player.x,
      y: player.y,
      dx: shootX*10,
      dy: shootY*10,
      size: 12,
      color:"green"
    });
  }
}

// Dessiner la moufette
function drawMoufette(x,y,size){
  // Corps
  ctx.fillStyle="#333";
  ctx.beginPath();
  ctx.ellipse(x,y,size*0.6,size,"0",0,Math.PI*2);
  ctx.fill();
  // Tête
  ctx.fillStyle="#555";
  ctx.beginPath();
  ctx.ellipse(x,y-size*0.8,size*0.4,size*0.5,0,0,Math.PI*2);
  ctx.fill();
  // Yeux
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.ellipse(x-10,y-80,8,12,0,0,Math.PI*2);
  ctx.fill();
  ctx.beginPath();
  ctx.ellipse(x+10,y-80,8,12,0,0,Math.PI*2);
  ctx.fill();
  ctx.fillStyle="black";
  ctx.beginPath();
  ctx.ellipse(x-10,y-80,4,6,0,0,Math.PI*2);
  ctx.fill();
  ctx.beginPath();
  ctx.ellipse(x+10,y-80,4,6,0,0,Math.PI*2);
  ctx.fill();
}

// Dessiner champignons
function drawMushroom(m){
  ctx.fillStyle=m.stemColor;
  ctx.fillRect(m.x,m.y,m.width,m.height);
  ctx.fillStyle=m.capColor;
  ctx.beginPath();
  ctx.ellipse(m.x+m.width/2,m.y,m.width*0.8,m.height*0.6,0,0,Math.PI);
  ctx.fill();
}

// Boucle de jeu
function update(){
  player.x += moveX*player.speed;
  player.y += moveY*player.speed;
  player.x = Math.max(0, Math.min(canvas.width, player.x));
  player.y = Math.max(0, Math.min(canvas.height, player.y));

  shoot();

  bullets.forEach((b,i)=>{
    b.x += b.dx;
    b.y += b.dy;
    mushrooms.forEach((m,j)=>{
      if(b.x > m.x && b.x < m.x+m.width && b.y > m.y && b.y < m.y+m.height){
        mushrooms.splice(j,1);
        bullets.splice(i,1);
      }
    });
    if(b.x<0 || b.x>canvas.width || b.y<0 || b.y>canvas.height){
      bullets.splice(i,1);
    }
  });

  document.getElementById('healthBar').style.width = (player.life/player.maxLife*200) + 'px';
  document.getElementById('shieldBar').style.width = (player.shields/player.maxShields*200) + 'px';
}

function draw(){
  // Forêt nuit
  ctx.fillStyle="#001a00";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  // Champignons
  mushrooms.forEach(drawMushroom);
  // Moufette
  drawMoufette(player.x,player.y,player.size);
  // Projectiles verts
  bullets.forEach(b=>{
    ctx.fillStyle=b.color;
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.size/2,0,Math.PI*2);
    ctx.fill();
  });
}

function gameLoop(){
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
